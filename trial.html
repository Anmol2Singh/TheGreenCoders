<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Soil Smart Card - Visual Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #98FB98 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #228B22, #32CD32);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .form-section {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #228B22;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #32CD32;
        }
        
        .btn {
            background: #228B22;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #32CD32;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .result-section {
            display: none;
            background: #e8f5e8;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
            border: 3px solid #228B22;
        }
        
        .result-section.show {
            display: block;
        }
        
        .visual-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        .qr-result {
            text-align: center;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #32CD32;
            height: fit-content;
        }
        
        .qr-result h3 {
            color: #228B22;
            margin-bottom: 15px;
        }
        
        .qr-container {
            margin: 20px 0;
            padding: 20px;
            background: #f0f8f0;
            border-radius: 10px;
            border: 2px dashed #32CD32;
        }
        
        .visual-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            margin: 20px 0;
            background: #fafafa;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #e0e0e0;
        }
        
        .soil-visual {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .soil-indicator {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            min-width: 120px;
        }
        
        .soil-icon {
            font-size: 3em;
            margin-bottom: 10px;
            display: block;
        }
        
        .ph-meter {
            width: 100%;
            height: 30px;
            background: linear-gradient(to right, #ff4444, #ffaa00, #44ff44, #0099ff);
            border-radius: 15px;
            position: relative;
            margin: 15px 0;
            border: 2px solid #333;
        }
        
        .ph-indicator {
            position: absolute;
            top: -5px;
            width: 20px;
            height: 40px;
            background: #333;
            border-radius: 3px;
            transform: translateX(-50%);
        }
        
        .nutrient-bar {
            width: 100%;
            height: 25px;
            background: #f0f0f0;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid #ccc;
        }
        
        .nutrient-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
        }
        
        .nutrient-low { background: linear-gradient(90deg, #ff6b6b, #ff8787); }
        .nutrient-medium { background: linear-gradient(90deg, #feca57, #ff9ff3); }
        .nutrient-high { background: linear-gradient(90deg, #48dbfb, #0abde3); }
        
        .soil-health-gauge {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
        }
        
        .gauge-bg {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #ff4444 0deg 60deg, #ffaa00 60deg 120deg, #44ff44 120deg 180deg, #00aa44 180deg 240deg, #0088ff 240deg 300deg, #0044aa 300deg 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gauge-inner {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        
        .recommendations {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .recommendations h4 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .recommendations ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .recommendations li {
            margin: 10px 0;
            padding: 8px 12px;
            background: rgba(255, 235, 59, 0.2);
            border-radius: 5px;
            border-left: 3px solid #ffc107;
        }
        
        .crop-visual {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .crop-card {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: transform 0.3s;
        }
        
        .crop-card:hover {
            transform: scale(1.05);
            border-color: #28a745;
        }
        
        .crop-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .demo-farmers {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
        }
        
        .demo-grid {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .demo-card {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid transparent;
            text-align: center;
            min-width: 200px;
        }
        
        .demo-card:hover {
            transform: scale(1.05);
            border-color: #32CD32;
        }
        
        .status-excellent { color: #28a745; font-weight: bold; }
        .status-good { color: #28a745; font-weight: bold; }
        .status-medium { color: #ffc107; font-weight: bold; }
        .status-poor { color: #dc3545; font-weight: bold; }
        
        @media (max-width: 768px) {
            .visual-grid {
                grid-template-columns: 1fr;
            }
            
            .soil-visual {
                flex-direction: column;
                align-items: center;
            }
            
            .demo-grid {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå± E-Soil Smart Card</h1>
            <p>Visual Soil Health Management System</p>
        </div>
        
        <div class="main-content">
            <div class="form-section">
                <h2>üë®‚Äçüåæ Register New Farmer</h2>
                <p>Enter farmer details and soil conditions to generate visual smart card</p>
                
                <form id="farmerForm">
                    <div class="form-grid">
                        <div>
                            <h3>Personal Information</h3>
                            <div class="form-group">
                                <label>Farmer Name *</label>
                                <input type="text" id="farmerName" required placeholder="Enter farmer name" value="Test Farmer">
                            </div>
                            <div class="form-group">
                                <label>Village *</label>
                                <input type="text" id="village" required placeholder="Enter village name" value="Test Village">
                            </div>
                            <div class="form-group">
                                <label>State *</label>
                                <select id="state" required>
                                    <option value="">Select State</option>
                                    <option value="Uttar Pradesh" selected>Uttar Pradesh</option>
                                    <option value="Punjab">Punjab</option>
                                    <option value="Haryana">Haryana</option>
                                    <option value="Bihar">Bihar</option>
                                    <option value="Maharashtra">Maharashtra</option>
                                    <option value="Rajasthan">Rajasthan</option>
                                    <option value="Gujarat">Gujarat</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Farm Size (acres) *</label>
                                <input type="number" id="farmSize" required placeholder="Enter farm size" step="0.1" value="2.5">
                            </div>
                        </div>
                        
                        <div>
                            <h3>Soil Health Parameters</h3>
                            <div class="form-group">
                                <label>pH Level *</label>
                                <input type="number" id="ph" required placeholder="6.0 - 8.5" step="0.1" min="4" max="10" value="7.0">
                            </div>
                            <div class="form-group">
                                <label>Nitrogen Level *</label>
                                <select id="nitrogen" required>
                                    <option value="">Select Level</option>
                                    <option value="Low">Low (< 280 kg/ha)</option>
                                    <option value="Medium" selected>Medium (280-560 kg/ha)</option>
                                    <option value="High">High (> 560 kg/ha)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Phosphorus Level *</label>
                                <select id="phosphorus" required>
                                    <option value="">Select Level</option>
                                    <option value="Low" selected>Low (< 10 kg/ha)</option>
                                    <option value="Medium">Medium (10-25 kg/ha)</option>
                                    <option value="High">High (> 25 kg/ha)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Potassium Level *</label>
                                <select id="potassium" required>
                                    <option value="">Select Level</option>
                                    <option value="Low">Low (< 108 kg/ha)</option>
                                    <option value="Medium">Medium (108-280 kg/ha)</option>
                                    <option value="High" selected>High (> 280 kg/ha)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button type="submit" class="btn">üéØ Generate Visual Smart Card</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">üîÑ Reset Form</button>
                    </div>
                </form>
            </div>
            
            <div id="resultSection" class="result-section">
                <!-- Visual results will be displayed here -->
            </div>
            
            <!-- Demo Farmers Section -->
            <div class="demo-farmers">
                <h2>üì± Demo Visual Farmers</h2>
                <p>Click on any farmer card to see visual soil analysis with charts and indicators:</p>
                
                <div class="demo-grid">
                    <div class="demo-card" onclick="showVisualFarmer('farmer1')">
                        <h3 style="color: #228B22; margin-bottom: 10px;">üßë‚Äçüåæ Rajesh Kumar</h3>
                        <canvas id="qr1" width="120" height="120" style="border: 2px solid #228B22; border-radius: 8px;"></canvas>
                        <p><strong>Rampur Village, UP</strong></p>
                        <p style="font-size: 0.9em; color: #666;">Mixed soil conditions</p>
                        <div style="margin-top: 10px;">
                            <span style="color: #dc3545;">‚óè</span> pH: 6.8
                            <span style="color: #ffc107;">‚óè</span> N: Medium
                        </div>
                    </div>
                    
                    <div class="demo-card" onclick="showVisualFarmer('farmer2')">
                        <h3 style="color: #228B22; margin-bottom: 10px;">üë©‚Äçüåæ Priya Sharma</h3>
                        <canvas id="qr2" width="120" height="120" style="border: 2px solid #228B22; border-radius: 8px;"></canvas>
                        <p><strong>Green Valley, Punjab</strong></p>
                        <p style="font-size: 0.9em; color: #666;">Excellent soil health</p>
                        <div style="margin-top: 10px;">
                            <span style="color: #28a745;">‚óè</span> pH: 7.2
                            <span style="color: #28a745;">‚óè</span> N: High
                        </div>
                    </div>
                    
                    <div class="demo-card" onclick="showVisualFarmer('farmer3')">
                        <h3 style="color: #228B22; margin-bottom: 10px;">üßë‚Äçüåæ Ahmed Ali</h3>
                        <canvas id="qr3" width="120" height="120" style="border: 2px solid #228B22; border-radius: 8px;"></canvas>
                        <p><strong>Sahara Fields, Rajasthan</strong></p>
                        <p style="font-size: 0.9em; color: #666;">Needs improvement</p>
                        <div style="margin-top: 10px;">
                            <span style="color: #dc3545;">‚óè</span> pH: 8.1
                            <span style="color: #dc3545;">‚óè</span> N: Low
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="visualFarmerInfo" class="result-section">
                <!-- Visual farmer information will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Sample farmer data with visual elements
        const visualFarmerData = {
            farmer1: {
                name: "Rajesh Kumar",
                village: "Rampur Village",
                state: "Uttar Pradesh",
                farmerId: "SHC-UP-2024-001",
                farmSize: "2.5 acres",
                soilData: {
                    ph: 6.8,
                    nitrogen: "Medium",
                    phosphorus: "Low",
                    potassium: "High",
                    organicCarbon: 1.2,
                    ec: 0.4,
                    zinc: "Low",
                    iron: "Medium"
                },
                recommendations: [
                    "Apply 20kg DAP per acre for Phosphorus deficiency",
                    "Use biofertilizer containing Azotobacter for Nitrogen",
                    "Recommended crops: Wheat, Sugarcane, Rice",
                    "Apply Smart Biochar 500kg per acre",
                    "Use cyanobacteria capsules for organic matter enhancement"
                ],
                crops: ["üåæ", "üåΩ", "üåæ", "üçö"]
            },
            farmer2: {
                name: "Priya Sharma",
                village: "Green Valley",
                state: "Punjab",
                farmerId: "SHC-PB-2024-045",
                farmSize: "5 acres",
                soilData: {
                    ph: 7.2,
                    nitrogen: "High",
                    phosphorus: "Medium",
                    potassium: "Medium",
                    organicCarbon: 1.8,
                    ec: 0.6,
                    zinc: "Medium",
                    iron: "High"
                },
                recommendations: [
                    "Soil health is excellent, maintain current practices",
                    "Recommended crops: Cotton, Maize, Vegetables, Wheat",
                    "Apply balanced NPK 19:19:19 at 100kg per acre",
                    "Consider crop rotation with legumes for nitrogen fixation",
                    "Use vermicompost 2 tons per acre annually"
                ],
                crops: ["üåæ", "üåΩ", "ü•¨", "üåø"]
            },
            farmer3: {
                name: "Ahmed Ali",
                village: "Ganganagar",
                state: "Rajasthan",
                farmerId: "SHC-RJ-2024-078",
                farmSize: "3 acres",
                soilData: {
                    ph: 8.1,
                    nitrogen: "Low",
                    phosphorus: "Low",
                    potassium: "Low",
                    organicCarbon: 0.8,
                    ec: 1.2,
                    zinc: "Low",
                    iron: "Low"
                },
                recommendations: [
                    "‚ö†Ô∏è Soil needs significant improvement - alkaline and nutrient deficient",
                    "Apply gypsum 500kg per acre to reduce alkalinity",
                    "Use complex fertilizer 20:20:0 at 150kg per acre",
                    "Recommended crops: Pearl Millet, Sorghum, Groundnut",
                    "Apply organic matter 3-4 tons per acre urgently"
                ],
                crops: ["üåæ", "ü•ú", "üåø", "üå±"]
            }
        };

        // Form event listener
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('farmerForm');
            if (form) {
                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    generateVisualSmartCard();
                });
            }
        });

        function generateVisualSmartCard() {
            // Get form data
            const farmerData = {
                name: document.getElementById('farmerName').value,
                village: document.getElementById('village').value,
                state: document.getElementById('state').value,
                farmSize: document.getElementById('farmSize').value,
                ph: parseFloat(document.getElementById('ph').value),
                nitrogen: document.getElementById('nitrogen').value,
                phosphorus: document.getElementById('phosphorus').value,
                potassium: document.getElementById('potassium').value
            };

            // Generate unique farmer ID
            const stateCode = farmerData.state.substring(0, 2).toUpperCase();
            const farmerId = `SHC-${stateCode}-2024-${String(Math.floor(Math.random() * 1000)).padStart(3, '0')}`;

            // Generate recommendations
            const recommendations = generateRecommendations(farmerData);

            // Display visual results
            displayVisualResults(farmerData, farmerId, recommendations);
        }

        function generateRecommendations(data) {
            const recommendations = [];
            
            // pH recommendations
            if (data.ph < 6.0) {
                recommendations.push("Apply lime 200-500kg per acre to increase soil pH");
            } else if (data.ph > 8.0) {
                recommendations.push("Apply gypsum 300-600kg per acre to reduce soil alkalinity");
            } else {
                recommendations.push("pH level is optimal for most crops");
            }

            // Nutrient recommendations
            if (data.nitrogen === 'Low') {
                recommendations.push("Apply Urea 100-150kg per acre or use Azotobacter biofertilizer");
            } else if (data.nitrogen === 'Medium') {
                recommendations.push("Maintain nitrogen with balanced fertilization");
            } else {
                recommendations.push("Nitrogen is sufficient, avoid over-fertilization");
            }

            if (data.phosphorus === 'Low') {
                recommendations.push("Apply DAP 50-100kg per acre for phosphorus deficiency");
            }

            if (data.potassium === 'Low') {
                recommendations.push("Apply Muriate of Potash 30-60kg per acre");
            }

            // Crop recommendations
            const cropsByState = {
                'Punjab': ['Wheat', 'Rice', 'Cotton', 'Sugarcane'],
                'Uttar Pradesh': ['Wheat', 'Rice', 'Sugarcane', 'Potato'],
                'Rajasthan': ['Pearl Millet', 'Sorghum', 'Groundnut', 'Mustard'],
                'Maharashtra': ['Cotton', 'Sugarcane', 'Soybean', 'Onion']
            };
            
            const stateCrops = cropsByState[data.state] || ['Wheat', 'Rice', 'Vegetables'];
            recommendations.push(`Recommended crops for ${data.state}: ${stateCrops.join(', ')}`);

            return recommendations;
        }

        function displayVisualResults(farmerData, farmerId, recommendations) {
            const resultSection = document.getElementById('resultSection');
            
            // Generate QR Data
            const qrData = `FARMER-ID:${farmerId}|NAME:${farmerData.name}|VILLAGE:${farmerData.village}|STATE:${farmerData.state}`;
            
            resultSection.innerHTML = `
                <h2>‚úÖ Visual Smart Card Generated!</h2>
                
                <div class="visual-grid">
                    <div class="qr-result">
                        <h3>üì± Smart QR Code</h3>
                        <div class="qr-container">
                            <canvas id="generatedQR" width="200" height="200" style="border: 3px solid #228B22; background: white;"></canvas>
                        </div>
                        <p><strong>Farmer ID:</strong> ${farmerId}</p>
                        <button class="btn" onclick="scanGeneratedQR('${farmerId}')">üîç Simulate Scan</button>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #f0f8f0; border-radius: 10px;">
                            <h4>üë®‚Äçüåæ Farmer Profile</h4>
                            <p><strong>Name:</strong> ${farmerData.name}</p>
                            <p><strong>Village:</strong> ${farmerData.village}</p>
                            <p><strong>State:</strong> ${farmerData.state}</p>
                            <p><strong>Farm Size:</strong> ${farmerData.farmSize} acres</p>
                        </div>
                    </div>
                    
                    <div class="visual-content">
                        <h3>üìä Visual Soil Analysis</h3>
                        
                        <!-- pH Meter Visual -->
                        <div style="margin: 20px 0;">
                            <h4>üå°Ô∏è pH Level: ${farmerData.ph}</h4>
                            <div class="ph-meter">
                                <div class="ph-indicator" style="left: ${((farmerData.ph - 4) / 6) * 100}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9em;">
                                <span>Acidic (4)</span>
                                <span>Neutral (7)</span>
                                <span>Alkaline (10)</span>
                            </div>
                        </div>
                        
                        <!-- Nutrient Bars -->
                        <div style="margin: 25px 0;">
                            <h4>üß™ Nutrient Levels</h4>
                            
                            <div style="margin: 15px 0;">
                                <label style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="font-size: 1.5em; margin-right: 10px;">üü¶</span>
                                    <strong>Nitrogen: ${farmerData.nitrogen}</strong>
                                </label>
                                <div class="nutrient-bar">
                                    <div class="nutrient-fill nutrient-${farmerData.nitrogen.toLowerCase()}" 
                                         style="width: ${getNutrientWidth(farmerData.nitrogen)}%;"></div>
                                </div>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <label style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="font-size: 1.5em; margin-right: 10px;">üü®</span>
                                    <strong>Phosphorus: ${farmerData.phosphorus}</strong>
                                </label>
                                <div class="nutrient-bar">
                                    <div class="nutrient-fill nutrient-${farmerData.phosphorus.toLowerCase()}" 
                                         style="width: ${getNutrientWidth(farmerData.phosphorus)}%;"></div>
                                </div>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <label style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="font-size: 1.5em; margin-right: 10px;">üü™</span>
                                    <strong>Potassium: ${farmerData.potassium}</strong>
                                </label>
                                <div class="nutrient-bar">
                                    <div class="nutrient-fill nutrient-${farmerData.potassium.toLowerCase()}" 
                                         style="width: ${getNutrientWidth(farmerData.potassium)}%;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Soil Health Gauge -->
                        <div style="text-align: center; margin: 30px 0;">
                            <h4>üéØ Overall Soil Health Score</h4>
                            <div class="soil-health-gauge">
                                <div class="gauge-bg">
                                    <div class="gauge-inner">
                                        <div style="font-size: 2em; font-weight: bold; color: ${getSoilHealthColor(farmerData)};">
                                            ${calculateSoilScore(farmerData)}%
                                        </div>
                                        <div style="font-size: 0.9em; color: #666;">
                                            Health Score
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chart Container -->
                        <div class="chart-container">
                            <canvas id="soilChart"></canvas>
                        </div>
                        
                        <!-- Visual Soil Indicators -->
                        <div class="soil-visual">
                            <div class="soil-indicator" style="border-color: ${getSoilHealthColor(farmerData)};">
                                <span class="soil-icon">üå±</span>
                                <h4>Soil Type</h4>
                                <p>${getSoilType(farmerData)}</p>
                            </div>
                            
                            <div class="soil-indicator" style="border-color: ${getPhColor(farmerData.ph)};">
                                <span class="soil-icon">‚öóÔ∏è</span>
                                <h4>pH Status</h4>
                                <p>${getPhStatus(farmerData.ph)}</p>
                            </div>
                            
                            <div class="soil-indicator" style="border-color: ${getFertilityColor(farmerData)};">
                                <span class="soil-icon">üöú</span>
                                <h4>Fertility</h4>
                                <p>${getFertilityStatus(farmerData)}</p>
                            </div>
                            
                            <div class="soil-indicator" style="border-color: #28a745;">
                                <span class="soil-icon">üíß</span>
                                <h4>Irrigation</h4>
                                <p>${getIrrigationRecommendation(farmerData)}</p>
                            </div>
                        </div>
                        
                        <!-- Recommended Crops Visual -->
                        <div style="margin: 30px 0;">
                            <h4>üåæ Recommended Crops</h4>
                            <div class="crop-visual">
                                ${getRecommendedCropsVisual(farmerData.state)}
                            </div>
                        </div>
                        
                        <div class="recommendations">
                            <h4>üí° Smart Agricultural Recommendations</h4>
                            <ul>
                                ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn" onclick="speakRecommendations('${recommendations.join('. ')}')">üîä Voice Recommendations</button>
                            <button class="btn btn-secondary" onclick="downloadReport('${farmerId}')">üìÑ Download Report</button>
                        </div>
                    </div>
                </div>
            `;
            
            resultSection.classList.add('show');
            
            // Generate QR Code
            setTimeout(() => {
                generateQRCode('generatedQR', qrData);
                createSoilChart(farmerData);
            }, 500);
        }

        function showVisualFarmer(farmerId) {
            const farmer = visualFarmerData[farmerId];
            const infoDiv = document.getElementById('visualFarmerInfo');
            
            infoDiv.innerHTML = `
                <h2>üì± Visual Farmer Analysis</h2>
                
                <div class="visual-grid">
                    <div class="qr-result">
                        <h3>üßë‚Äçüåæ ${farmer.name}</h3>
                        <div style="background: #f0f8f0; padding: 20px; border-radius: 10px; margin: 15px 0;">
                            <p><strong>Village:</strong> ${farmer.village}</p>
                            <p><strong>State:</strong> ${farmer.state}</p>
                            <p><strong>Farmer ID:</strong> ${farmer.farmerId}</p>
                            <p><strong>Farm Size:</strong> ${farmer.farmSize}</p>
                        </div>
                        
                        <!-- Mini Soil Health Gauge -->
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="width: 150px; height: 150px; margin: 0 auto; border-radius: 50%; background: conic-gradient(from 0deg, #ff4444 0deg 60deg, #ffaa00 60deg 120deg, #44ff44 120deg 240deg, #0088ff 240deg 360deg); display: flex; align-items: center; justify-content: center;">
                                <div style="width: 100px; height: 100px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                    <div style="font-size: 1.5em; font-weight: bold; color: ${getSampleSoilHealthColor(farmer.soilData)};">
                                        ${calculateSampleSoilScore(farmer.soilData)}%
                                    </div>
                                    <div style="font-size: 0.8em; color: #666;">Health</div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn" onclick="speakRecommendations('${farmer.recommendations.join('. ')}')">üîä Voice Advisory</button>
                    </div>
                    
                    <div class="visual-content">
                        <h3>üìä Detailed Soil Analysis</h3>
                        
                        <!-- pH Meter for Sample -->
                        <div style="margin: 20px 0;">
                            <h4>üå°Ô∏è pH Level: ${farmer.soilData.ph}</h4>
                            <div class="ph-meter">
                                <div class="ph-indicator" style="left: ${((farmer.soilData.ph - 4) / 6) * 100}%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9em;">
                                <span>Acidic (4)</span>
                                <span>Neutral (7)</span>
                                <span>Alkaline (10)</span>
                            </div>
                        </div>
                        
                        <!-- Sample Nutrient Bars -->
                        <div style="margin: 25px 0;">
                            <h4>üß™ Nutrient Analysis</h4>
                            
                            <div style="margin: 15px 0;">
                                <label style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="font-size: 1.5em; margin-right: 10px;">üü¶</span>
                                    <strong>Nitrogen: ${farmer.soilData.nitrogen}</strong>
                                </label>
                                <div class="nutrient-bar">
                                    <div class="nutrient-fill nutrient-${farmer.soilData.nitrogen.toLowerCase()}" 
                                         style="width: ${getNutrientWidth(farmer.soilData.nitrogen)}%;"></div>
                                </div>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <label style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="font-size: 1.5em; margin-right: 10px;">üü®</span>
                                    <strong>Phosphorus: ${farmer.soilData.phosphorus}</strong>
                                </label>
                                <div class="nutrient-bar">
                                    <div class="nutrient-fill nutrient-${farmer.soilData.phosphorus.toLowerCase()}" 
                                         style="width: ${getNutrientWidth(farmer.soilData.phosphorus)}%;"></div>
                                </div>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <label style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="font-size: 1.5em; margin-right: 10px;">üü™</span>
                                    <strong>Potassium: ${farmer.soilData.potassium}</strong>
                                </label>
                                <div class="nutrient-bar">
                                    <div class="nutrient-fill nutrient-${farmer.soilData.potassium.toLowerCase()}" 
                                         style="width: ${getNutrientWidth(farmer.soilData.potassium)}%;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Additional Soil Properties -->
                        <div style="margin: 25px 0;">
                            <h4>üî¨ Additional Soil Properties</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                                    <strong>Organic Carbon</strong>
                                    <div style="font-size: 1.2em; color: #17a2b8;">${farmer.soilData.organicCarbon}%</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #6f42c1;">
                                    <strong>EC Level</strong>
                                    <div style="font-size: 1.2em; color: #6f42c1;">${farmer.soilData.ec} dS/m</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #fd7e14;">
                                    <strong>Zinc</strong>
                                    <div style="font-size: 1.2em; color: ${getSampleStatusClass(farmer.soilData.zinc)}; font-weight: bold;">${farmer.soilData.zinc}</div>
                                </div>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #20c997;">
                                    <strong>Iron</strong>
                                    <div style="font-size: 1.2em; color: ${getSampleStatusClass(farmer.soilData.iron)}; font-weight: bold;">${farmer.soilData.iron}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chart Container -->
                        <div class="chart-container">
                            <canvas id="sampleChart_${farmerId}"></canvas>
                        </div>
                        
                        <!-- Recommended Crops -->
                        <div style="margin: 30px 0;">
                            <h4>üåæ Suitable Crops for This Soil</h4>
                            <div class="crop-visual">
                                ${farmer.crops.map(crop => `
                                    <div class="crop-card">
                                        <div class="crop-icon">${crop}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="recommendations">
                            <h4>üéØ Personalized Recommendations</h4>
                            <ul>
                                ${farmer.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            infoDiv.classList.add('show');
            
            // Generate sample chart
            setTimeout(() => {
                createSampleChart(farmer.soilData, farmerId);
            }, 500);
            
            // Scroll to results
            infoDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Utility Functions
        function calculateSoilScore(data) {
            let score = 0;
            
            // pH score (30%)
            if (data.ph >= 6.5 && data.ph <= 7.5) score += 30;
            else if (data.ph >= 6.0 && data.ph <= 8.0) score += 20;
            else score += 10;
            
            // Nutrient scores (70% total)
            const nutrients = [data.nitrogen, data.phosphorus, data.potassium];
            nutrients.forEach(nutrient => {
                if (nutrient === 'High') score += 23;
                else if (nutrient === 'Medium') score += 15;
                else score += 7;
            });
            
            return Math.round(score);
        }

        function calculateSampleSoilScore(soilData) {
            let score = 0;
            
            // pH score (25%)
            if (soilData.ph >= 6.5 && soilData.ph <= 7.5) score += 25;
            else if (soilData.ph >= 6.0 && soilData.ph <= 8.0) score += 15;
            else score += 5;
            
            // Major nutrient scores (45% total)
            const nutrients = [soilData.nitrogen, soilData.phosphorus, soilData.potassium];
            nutrients.forEach(nutrient => {
                if (nutrient === 'High') score += 15;
                else if (nutrient === 'Medium') score += 10;
                else score += 5;
            });
            
            // Minor nutrients (20% total)
            const minorNutrients = [soilData.zinc, soilData.iron];
            minorNutrients.forEach(nutrient => {
                if (nutrient === 'High') score += 10;
                else if (nutrient === 'Medium') score += 7;
                else score += 3;
            });
            
            // Organic carbon bonus (10%)
            if (soilData.organicCarbon >= 1.5) score += 10;
            else if (soilData.organicCarbon >= 1.0) score += 7;
            else score += 3;
            
            return Math.round(score);
        }

        function getSoilHealthColor(data) {
            const score = calculateSoilScore(data);
            if (score >= 80) return '#28a745';
            if (score >= 60) return '#ffc107';
            return '#dc3545';
        }

        function getSampleSoilHealthColor(soilData) {
            const score = calculateSampleSoilScore(soilData);
            if (score >= 80) return '#28a745';
            if (score >= 60) return '#ffc107';
            return '#dc3545';
        }

        function getNutrientWidth(level) {
            switch(level) {
                case 'High': return 85;
                case 'Medium': return 55;
                case 'Low': return 25;
                default: return 0;
            }
        }

        function getSoilType(data) {
            if (data.ph < 6.5) return 'Acidic Soil';
            if (data.ph > 7.5) return 'Alkaline Soil';
            return 'Neutral Soil';
        }

        function getPhColor(ph) {
            if (ph >= 6.5 && ph <= 7.5) return '#28a745';
            if (ph >= 6.0 && ph <= 8.0) return '#ffc107';
            return '#dc3545';
        }

        function getPhStatus(ph) {
            if (ph < 6.0) return 'Too Acidic';
            if (ph > 8.0) return 'Too Alkaline';
            if (ph >= 6.5 && ph <= 7.5) return 'Optimal';
            return 'Acceptable';
        }

        function getFertilityColor(data) {
            const highCount = [data.nitrogen, data.phosphorus, data.potassium].filter(n => n === 'High').length;
            if (highCount >= 2) return '#28a745';
            if (highCount >= 1) return '#ffc107';
            return '#dc3545';
        }

        function getFertilityStatus(data) {
            const highCount = [data.nitrogen, data.phosphorus, data.potassium].filter(n => n === 'High').length;
            const lowCount = [data.nitrogen, data.phosphorus, data.potassium].filter(n => n === 'Low').length;
            
            if (highCount >= 2) return 'High';
            if (lowCount >= 2) return 'Low';
            return 'Medium';
        }

        function getIrrigationRecommendation(data) {
            if (data.ph > 8.0) return 'Drip Irrigation';
            if (getFertilityStatus(data) === 'High') return 'Regular';
            return 'Moderate';
        }

        function getRecommendedCropsVisual(state) {
            const cropIcons = {
                'Punjab': [
                    { icon: 'üåæ', name: 'Wheat' },
                    { icon: 'üçö', name: 'Rice' },
                    { icon: 'üåø', name: 'Cotton' },
                    { icon: 'üåΩ', name: 'Maize' }
                ],
                'Uttar Pradesh': [
                    { icon: 'üåæ', name: 'Wheat' },
                    { icon: 'üçö', name: 'Rice' },
                    { icon: 'ü•î', name: 'Potato' },
                    { icon: 'üåø', name: 'Sugarcane' }
                ],
                'Rajasthan': [
                    { icon: 'üåæ', name: 'Millet' },
                    { icon: 'ü•ú', name: 'Groundnut' },
                    { icon: 'üåª', name: 'Mustard' },
                    { icon: 'üåø', name: 'Sorghum' }
                ]
            };
            
            const crops = cropIcons[state] || cropIcons['Punjab'];
            
            return crops.map(crop => `
                <div class="crop-card">
                    <div class="crop-icon">${crop.icon}</div>
                    <div style="font-size: 0.9em; font-weight: bold;">${crop.name}</div>
                </div>
            `).join('');
        }

        function getSampleStatusClass(value) {
            if (value === 'High') return '#28a745';
            if (value === 'Medium') return '#ffc107';
            return '#dc3545';
        }

        function createSoilChart(data) {
            const ctx = document.getElementById('soilChart');
            if (ctx && typeof Chart !== 'undefined') {
                new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['pH Level', 'Nitrogen', 'Phosphorus', 'Potassium', 'Overall Health'],
                        datasets: [{
                            label: 'Current Soil Status',
                            data: [
                                ((data.ph - 4) / 6) * 100, // Normalize pH to 0-100
                                getNutrientWidth(data.nitrogen),
                                getNutrientWidth(data.phosphorus),
                                getNutrientWidth(data.potassium),
                                calculateSoilScore(data)
                            ],
                            backgroundColor: 'rgba(34, 139, 34, 0.2)',
                            borderColor: 'rgba(34, 139, 34, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(34, 139, 34, 1)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                angleLines: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                pointLabels: {
                                    font: {
                                        size: 12,
                                        weight: 'bold'
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Soil Health Analysis Chart'
                            }
                        }
                    }
                });
            }
        }

        function createSampleChart(soilData, farmerId) {
            const ctx = document.getElementById(`sampleChart_${farmerId}`);
            if (ctx && typeof Chart !== 'undefined') {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Nitrogen', 'Phosphorus', 'Potassium', 'Zinc', 'Iron'],
                        datasets: [{
                            label: 'Nutrient Levels',
                            data: [
                                getNutrientWidth(soilData.nitrogen),
                                getNutrientWidth(soilData.phosphorus),
                                getNutrientWidth(soilData.potassium),
                                getNutrientWidth(soilData.zinc),
                                getNutrientWidth(soilData.iron)
                            ],
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.8)',
                                'rgba(255, 206, 86, 0.8)',
                                'rgba(153, 102, 255, 0.8)',
                                'rgba(255, 159, 64, 0.8)',
                                'rgba(32, 201, 151, 0.8)'
                            ],
                            borderColor: [
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)',
                                'rgba(32, 201, 151, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Level (%)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Detailed Nutrient Analysis'
                            }
                        }
                    }
                });
            }
        }

        function generateQRCode(elementId, data) {
            const canvas = document.getElementById(elementId);
            if (canvas && typeof QRious !== 'undefined') {
                try {
                    new QRious({
                        element: canvas,
                        value: data,
                        size: 200,
                        foreground: '#228B22',
                        background: '#ffffff'
                    });
                } catch (error) {
                    console.error('QR generation error:', error);
                }
            }
        }

        function scanGeneratedQR(farmerId) {
            alert(`üì± QR Code Scanned Successfully!\n\nFarmer ID: ${farmerId}\n\nIn real app, this would open farmer's profile with visual soil analysis!`);
        }

        function speakRecommendations(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.8;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            } else {
                alert('Voice feature not supported in this browser');
            }
        }

        function downloadReport(farmerId) {
            alert(`üìÑ Downloading comprehensive soil report for ${farmerId}...\n\nReport includes:\n- Visual soil analysis\n- Nutrient charts\n- Crop recommendations\n- Fertilizer schedule`);
        }

        function resetForm() {
            document.getElementById('farmerForm').reset();
            document.getElementById('resultSection').classList.remove('show');
            document.getElementById('visualFarmerInfo').classList.remove('show');
        }

        // Generate sample QR codes on load
        function generateSampleQRs() {
            try {
                if (typeof QRious !== 'undefined') {
                    // Sample QR codes
                    ['qr1', 'qr2', 'qr3'].forEach((id, index) => {
                        const canvas = document.getElementById(id);
                        const farmerId = `farmer${index + 1}`;
                        const farmer = visualFarmerData[farmerId];
                        
                        if (canvas && farmer) {
                            new QRious({
                                element: canvas,
                                value: `FARMER-ID:${farmer.farmerId}|NAME:${farmer.name}|VILLAGE:${farmer.village}`,
                                size: 120,
                                foreground: '#228B22',
                                background: '#ffffff'
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('Error generating sample QR codes:', error);
            }
        }

        // Initialize on page load
        window.onload = function() {
            setTimeout(generateSampleQRs, 1000);
        };
    </script>
</body>
</html>